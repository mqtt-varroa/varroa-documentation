\chapter{Scenario Concept}

%\begin{lstlisting}[caption={Implementierung des Trainierens der Markov-Chain}, captionpos=b, label={lst:train}, language=XML]
% <!-- -->
%\end{lstlisting}


\begin{lstlisting}[caption={XML Definition of the Scenario}, captionpos=b, label={lst:scenario}, language=XML]
<scenario>
	<broker id="b1">
		<!-- definition broker parameters -->
	</broker>
	
	<clientGroups>
		<!-- definition of client groups -->
	</clientGroups>
	
	<topicGroups>
		<!-- definition of topic groups -->
	</topicGroups>
	
	<subscriptions>
		<!-- definition of subscriptions -->
	</subscriptions>
	
	<stages>
		<!-- definition of stages -->
	</stages>
</scenario>
\end{lstlisting}

A Varroa test is the execution of a user defined Scenario, which is specified in a XML file.
To define a valid scenario the user needs to define the topology of the Scenario and the behaviour of its components.

\section{Broker}
\begin{lstlisting}[caption={XML definition of the Broker}, captionpos=b, label={lst:broker}, language=XML]
<scenario>
	<broker id="b1">
		<address>broker.hivemq.com</address>
		<port>1883</port>
	</broker>
</broker>
\end{lstlisting}
The broker is the central component whose performance and stress resistance is tested by the Scenario.
For this the user needs to define:
\begin{itemize}
	\item \textbf{id:} the identifier to reference the broker.
	\item \textbf{address:} the address of the broker can either be a IPv4-Address or a Fully-Qualified-Domain-Name.
	\item \textbf{port:} the port on which the broker is waiting for connections.
\end{itemize}

\section{Client Groups}
\begin{lstlisting}[caption={XML defininition of Client Groups}, captionpos=b, label={lst:clientGroups}, language=XML]
<scenario>
	<clientGroups>
		<clientGroup id="cg1">
			<clientIdPattern>A[1-9]+</clientIdPattern>
			<count>100</count>
			<mqtt>
				<!-- MQTT properties -->
			</mqtt>
		</clientGroup>

		<!-- definiton of more client groups -->
</scenario>
\end{lstlisting}
A Scenario contains a number of Client Groups.
A Client Group is a specific amount of MQTT Clients that share the exact same behaviour.
When defining a client group the user needs to specify:
\begin{itemize}
	\item \textbf{id:} the identifier to reference the Client Group.
	\item \textbf{clientIdPattern:} a regular expression to create individual names for every MQTT client in the Client Group.
	\item \textbf{count:} the amount of MQTT clients contained in the Client Group.
	\item \textbf{mqtt:} MQTT properties of the MQTT clients. (see \ref{sec:mqttProperties})
\end{itemize}

\section{Topic Groups}
\begin{lstlisting}[caption={XMl definition of Topic Groups}, captionpos=b, label={lst:topicGroups}, language=XML]
<scenario>
	<topicGroups>
		<topicGroup id="tg1">
			<topicNamePattern>topic/subtopic-[0-9]</topicNamePattern>
			<count>10</count>
		</topicGroup>

		<!-- definition of more topic groups -->
	</topicGroups>
</scenario>
\end{lstlisting}
A Scenario contains a number of Topic Groups.
A Topic Group is a specific amount of MQTT Topics whose names are created from the same regular expression.
When defining a Topic Group the user needs to specify:
\begin{itemize}
	\item \textbf{id:} the identifier to reference the Topic Group.
	\item \textbf{topicNamePattern:} a regular expression to create individual topic names for every member of the Topic Group.
	\item \textbf{count:} the amount of MQTT topics in the topic group.
\end{itemize}

\section{Subscriptions}
\begin{lstlisting}[caption={XMl definition of subscriptions}, captionpos=b, label={lst:subscriptions}, language=XML]
<scenario>
	<subscriptions>
		<subscription id="sub-1">
			<topicGroup>tg1</topicGroup>
			<wildCard>false</wildCard>
		</subscription>

		<subscription id="sub-2">
			<topicFilter>/topic/subtopic/subsubtopic/#</topicFilter>
		</subscription>

		<!-- definition of more subscriptions -->
	</subscriptions>
</scenario>
\end{lstlisting}
A Scenario can contain Subscriptions.
A Subscription defines a certain subscription behaviour that Client Groups can implement in their Subscribe Commands.
A Subscription can either target Topics that match a specific Topic Filter or a referenced Topic Group.
To define a Topic Group the user needs to specify:
\begin{itemize}
	\item \textbf{id:} the identifier to reference the Subscription.
	\item \textbf{topicFilter:} the Topic Filter to target specific Topics.
\end{itemize}
or
\begin{itemize}
	\item \textbf{id:} the identifier to reference the Subscription.
	\item \textbf{topicGroup:} reference to a Topic Group.
	\item \textbf{wildCard:} whether the Subscription contains a wild card. 
\end{itemize}

\section{Stages}
\begin{lstlisting}[caption={XMl definition of Stages}, captionpos=b, label={lst:stages}, language=XML]
<scenario>
	<stages>
		<stage id="s1" duration="10s">
			<lifecycle id="s1.l1" clientGroupId="cg1">
				<!-- definition of commands -->
			</lifecycle>
	
			<!-- definition of more lifecycles -->
		</stage>
	
		<!-- definition of more stages -->
	</stages>
</scenario>
\end{lstlisting}
A Scenario is divided into one or more Stages.
These Stages are executed in sequential order as they are specified in the XML document.
A Stage contains a number of Lifecycles, which specify the behaviour of Client Groups in the stage.
Lifecycles within a stage are executed in parallel.
To define a stage the user needs to specify:
\begin{itemize}
	\item \textbf{id:} the identifier to reference the Stage.
	\item \textbf{duration:} the duration of the stage. %TODO what happens if the execution takes longer
\end{itemize}
A Lifecycle contains an amount of Commands (see \ref{sec:commands}). To define a Lifecycle the user needs to specify:
\begin{itemize}
	\item \textbf{id:} the identifier to reference the Lifecycle.
	\item \textbf{clientGroupId:} the Client Group that executes this Lifecycle.
\end{itemize}

\section{Commands}\label{sec:commands}
\subsection{connect}
\begin{lstlisting}[caption={XMl definition of a connect command}, captionpos=b, label={lst:connect}, language=XML]
<connect broker="b1"/>
\end{lstlisting}
\subsection{disconnect}
\begin{lstlisting}[caption={XMl definition of a disconnect command}, captionpos=b, label={lst:disconnect}, language=XML]
<disconnect/>
\end{lstlisting}
\subsection{publish}
\begin{lstlisting}[caption={XMl definition of a publish commmand}, captionpos=b, label={lst:publish}, language=XML]
%TODO 
\end{lstlisting}
\subsection{subscribe}
\begin{lstlisting}[caption={XMl definition of a subscibe command}, captionpos=b, label={lst:subscirbe}, language=XML]
<subscribe subscription="sub1" qos="1"/>
\end{lstlisting}
\subsection{unsubscribe}
\begin{lstlisting}[caption={XMl definition of a unsubscibe command}, captionpos=b, label={lst:unsubscirbe}, language=XML]
<unsubscribe subscription="sub1"/>
\end{lstlisting}
\subsection{wait}
\begin{lstlisting}[caption={XMl definition of a wait command}, captionpos=b, label={lst:wait}, language=XML]
<wait topicGroup="tg1" duration="10s"/>
\end{lstlisting}
\subsection{for}
\begin{lstlisting}[caption={XMl definition of a for command}, captionpos=b, label={lst:for}, language=XML]
<for times="2">
	<connect broker="b1"/>
	<disconnect/>
</for>
\end{lstlisting}

\section{MQTT Properties}\label{sec:mqttProperties}



